<!DOCTYPE html>
<html lang="ja">
  <head>
    <base target="_top">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>共有フォルダ同期くん</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <?!= HtmlService.createHtmlOutputFromFile('css').getContent(); ?>
  </head>
  <body>
    <!-- ローディング画面 -->
    <div id="loading-overlay">
      <div class="loading-spinner"></div>
      <div class="loading-text">読み込み中...</div>
    </div>

    <!-- 進捗表示モーダル (新機能) -->
    <div class="modal fade" id="progress-modal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
          <div class="modal-body text-center p-5">
            <h4 class="mb-4 fw-bold text-primary">
              <i class="bi bi-arrow-repeat spin-icon me-2"></i>処理しています...
            </h4>
            <div class="progress-custom mb-3">
              <div id="sync-progress-bar" class="progress-bar-custom" style="width: 0%">0%</div>
            </div>
            <p id="sync-progress-text" class="text-muted small mb-0">準備中...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ヘッダー -->
    <nav class="navbar sticky-top navbar-light bg-white shadow-sm">
      <div class="container-fluid px-md-4">
        <span class="navbar-brand mb-0 h1 fw-bold text-primary d-flex align-items-center">
          <i class="bi bi-folder2-open me-2 fs-3"></i>
          <span>共有フォルダ同期くん</span>
        </span>
        <div class="text-muted small">
          <span class="d-none d-md-inline me-2">Ver 2.0</span>
          <i class="bi bi-gear-fill text-secondary" style="cursor: pointer;" onclick="Swal.fire('バージョン情報', '共有フォルダ同期くん Ver 2.0<br>GIGA山 Model', 'info')"></i>
        </div>
      </div>
    </nav>

    <!-- メインコンテンツ -->
    <div class="container py-4">
      <div class="row g-4">
        
        <!-- 左カラム：操作パネル -->
        <div class="col-lg-7">
          
          <!-- 実行ボタンエリア -->
          <div class="card mb-4 border-primary border-2">
            <div class="card-body text-center py-4">
              <h5 class="card-title fw-bold text-primary mb-3">
                <i class="bi bi-rocket-takeoff-fill me-2"></i>今すぐ配る
              </h5>
              <div class="d-grid gap-2 col-10 mx-auto">
                <!-- 本番実行ボタン -->
                <button class="btn btn-primary btn-lg shadow-sm" onclick="runSyncManual(false)">
                  <i class="bi bi-send-fill me-2"></i>ファイルを転送する
                </button>
                <!-- テスト実行ボタン (新機能) -->
                <button class="btn btn-warning text-white fw-bold shadow-sm" onclick="runSyncManual(true)">
                  <i class="bi bi-bug-fill me-2"></i>テスト転送 (ログのみ)
                </button>
              </div>
              <p class="card-text text-muted small mt-3 mb-0">
                テスト転送はファイルをコピーせず、ログだけを表示します。
              </p>
            </div>
          </div>

          <!-- 設定エリア -->
          <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0 fw-bold">
                <i class="bi bi-sliders me-2 text-primary"></i>
                転送設定
              </h5>
              <button class="btn btn-sm btn-outline-primary rounded-pill" onclick="addPair()">
                <i class="bi bi-plus-lg"></i> 追加
              </button>
            </div>
            <div class="card-body">
              <div class="alert alert-info d-flex align-items-center small py-2 mb-4" role="alert">
                <i class="bi bi-info-circle-fill me-2"></i>
                <div>GoogleドライブのURL末尾のIDを入力してください。<br>「名前」をつけると管理しやすくなります。</div>
              </div>

              <!-- JSで生成されるエリア -->
              <div id="folder-settings-container"></div>

              <div class="text-end mt-3">
                <button class="btn btn-success px-4" onclick="saveSettings()">
                  <i class="bi bi-save me-2"></i>設定を保存
                </button>
              </div>
            </div>
          </div>

          <!-- 自動モード設定 -->
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0 fw-bold">
                <i class="bi bi-clock-history me-2 text-primary"></i>
                自動モード
              </h5>
            </div>
            <div class="card-body">
              <div class="row align-items-end g-3">
                <div class="col-md-6">
                  <label class="form-label small text-muted">頻度</label>
                  <select class="form-select" id="sync-frequency">
                    <option value="hourly">1時間ごと</option>
                    <option value="daily">毎日（深夜0時）</option>
                    <option value="weekly">毎週（月曜 朝8時）</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <div class="mb-2 small text-end" id="auto-sync-status"></div>
                  <button id="btn-auto-sync" class="btn btn-secondary w-100" onclick="toggleAutoSync()">
                    読み込み中...
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 右カラム：ログ -->
        <div class="col-lg-5">
          <div class="card h-100">
            <div class="card-header bg-white">
              <h5 class="mb-0 fw-bold">
                <i class="bi bi-journal-text me-2 text-primary"></i>
                活動記録
              </h5>
            </div>
            <div class="card-body p-0">
              <ul class="log-list list-unstyled m-0" id="log-list">
                <li class="p-4 text-center text-muted">読み込み中...</li>
              </ul>
            </div>
            <div class="card-footer bg-light text-center small text-muted border-top-0 rounded-bottom-4">
              最新の50件を表示しています
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- フッター -->
    <footer class="text-center text-muted py-3 mt-4 border-top">
      <small>© 2026 共有フォルダ同期くん <a href="https://note.com/cute_borage86" target="_blank" class="text-decoration-none text-muted">GIGA山</a></small>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <?!= HtmlService.createHtmlOutputFromFile('js').getContent(); ?>
  </body>
</html>
